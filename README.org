#+title: Ollama Buddy: Local LLM Integration for Emacs
#+author: James Dyer
#+email: captainflasmr@gmail.com
#+language: en
#+options: ':t toc:nil author:nil email:nil num:nil title:nil
#+todo: TODO DOING | DONE
#+startup: showall

#+attr_org: :width 300px
#+attr_html: :width 50%
[[file:img/ollama-buddy-youtube-banner.jpg]]

* Welcome to OLLAMA BUDDY

Want to quickly access local running AI through Emacs and Ollama? This package provides a friendly Emacs interface for interacting with Ollama models and offers a convenient way to integrate to Ollama's local LLM capabilities directly into your Emacs workflow with little or no configuration required!

/"The name is just something a little bit fun and it seems to always remind me of the "bathroom buddy" from the film Gremlins (although hopefully this will work better than that seemed to!)"/

I have a youtube channel where where I am looking to regularly post videos showcasing the capabilities of the package. Check it out here:

https://www.youtube.com/@OllamaBuddyforEmacs

See [[file:docs/ollama-buddy.org]] for the manual!

You can install with literally no config, but I would suggest binding to both menus.

  #+begin_src elisp
   (use-package ollama-buddy
     :bind
     ("C-c o" . ollama-buddy-menu)
     ("C-c O" . ollama-buddy-transient-menu-wrapper))
  #+end_src

A simple text information screen will be presented on the first opening of the chat (by selecting "o" from any of the menus), its just a bit of fun, but I wanted a quick start tutorial/assistant type of feel, here is what will be presented:

#+begin_src
,#+TITLE: Ollama Buddy Chat

,* Welcome to OLLAMA BUDDY

,#+begin_example
 ___ _ _      n _ n      ___       _   _ _ _
|   | | |__._|o(Y)o|__._| . |_ _ _| |_| | | |
| | | | | .  |     | .  | . | | | . | . |__ |
|___|_|_|__/_|_|_|_|__/_|___|___|___|___|___|
,#+end_example

(a) *tinyllama:latest* Select Info Pull Copy Delete
(b) *qwen2.5-coder:7b* Select Info Pull Copy Delete
(c) *deepseek-r1:7b* Select Info Pull Copy Delete
(d) *codellama:7b* Select Info Pull Copy Delete
(e) *gemma3:4b* Select Info Pull Copy Delete
(f) *phi3:3.8b* Select Info Pull Copy Delete
(g) *llama3.2:1b* Select Info Pull Copy Delete

starcoder2:3b mistral:7b deepseek-r1:1.5b gemma3:1b qwen2.5-coder:3b llama3.2:3b

- Ask me anything!                    C-c C-c
- Main transient menu                 C-c O
- Cancel request                      C-c C-k
- Change model                        C-c m
- Browse prompt history               M-p/n/r
- Browse ollama-buddy manual          C-c ?
- Advanced interface (show all tips)  C-c A

,* *tinyllama:latest >> PROMPT:* <put prompt in here>
#+end_src

You will, of course, need to have =ollama serve= running, but technically, that is all you need! Emacs and =ollama-buddy= will handle the rest!

The example above has some models already pulled, but if you don't have any initially, the Recommended Models section will be fully populated with suggestions. Just click, or move your point over, and press return, and ollama-buddy via Ollama will pull that model for you asynchronously!

* Quick Demo Video

** 011 Real-time tracking and display

Submit some queries, with different models:

PROMPT>> why is the sky blue?
PROMPT>> why is the grass green?
PROMPT>> why is emacs so great?

and show the token usage and rate being displayed in the chat buffer.

Open the Token Usage stats from the menu

Open the Token Usage graph

Toggle on =ollama-buddy-toggle-token-display=

#+attr_org: :width 300px
#+attr_html: :width 100%
[[file:img/ollama-buddy-screen-recording_011.gif]]

See *Screenshots / Demos* section for more videos/demonstration.

* Whats New

** <2025-04-15> *0.9.22*

Enhanced session management

- Refactored =ollama-buddy-sessions-save= to autogenerate session names using timestamp and model.
- Improved session saving/loading by integrating org file handling.
- Updated mode line to display current session name dynamically.

Several improvements to session management, making it more intuitive and efficient for users. Here's a breakdown of the new functionality:

When saving a session, Ollama Buddy now creates a default name using the current timestamp and model name, users can still provide a custom name if desired.

An org file is now saved alongside the original elisp session file. This allows for better session recall as all interactions will be pulled back with the underlying session parameters still restored as before. There is an additional benefit in not only recalling precisely the session and any additional org interactions but also quickly saving to an org file for potential later inspection. Along with the improved autogenerated session name, this means it is much faster and more intuitive to save a snapshot of the current chat interaction.

The modeline now displays the current session name!

** <2025-04-11> *0.9.21*

Add history edit/view toggle features, so effectively merging the former history display into the history edit functionality.

** <2025-04-04> *0.9.20*

- Added =ollama-buddy-awesome.el= to integrate Awesome ChatGPT Prompts.

=ollama-buddy-awesome= is an =ollama-buddy= extension that integrates the popular [[https://github.com/f/awesome-chatgpt-prompts][Awesome ChatGPT Prompts]] repository, allowing you to leverage hundreds of curated prompts for various tasks and roles right within your Emacs environment, I thought that since I have integrated the =fabric= set of curated prompts then why not these!

There is a video demonstrate here : https://www.youtube.com/watch?v=5A4bTvjmPeo

*** Key Features

1. *Seamless Sync*: Automatically fetch the latest prompts from the GitHub repository, ensuring you always have access to the most up-to-date collection.

2. *Smart Categorization*: Prompts are intelligently categorized based on their content, making it easy to find the perfect prompt for your task.

3. *Interactive Selection*: Choose prompts through Emacs' familiar completion interface, with category and title information for quick identification.

4. *Effortless Application*: Apply selected prompts as system prompts in ollama-buddy with a single command, streamlining your AI-assisted workflow.

5. *Prompt Management*: List available prompts, preview their content, and display full prompt details on demand.

*** Getting Started

To access the Awesome ChatGPT prompts, just select the transient menu as normal and select "[a] Awesome ChatGPT Prompts", this will fetch the prompts and prepare everything for your first use and give you a transient menu as follows:

#+begin_example
Actions
[s] Send with Prompt
[p] Set as System Prompt
[l] List All Prompts
[c] Category Browser
[S] Sync Latest Prompts
[q] Back to Main Menu
#+end_example

Now available are a vast array of role-based and task-specific prompts, enhancing your =ollama-buddy= interactions in Emacs.

** <2025-04-01> *0.9.17*

- Added link to =ollama-buddy= info manual from the chat buffer and transient menu as MELPA has now picked it up and installed it!

** <2025-03-28> *0.9.16*

- Added =ollama-buddy-fix-encoding-issues= to handle text encoding problems.
- Refactored and streamline fabric pattern description handling.
- Removed unused fabric pattern categories to enhance maintainability.

** <2025-03-28> *0.9.15*

- Implement asynchronous operations for model management
  - Introduce non-blocking API requests for fetching, copying, and deleting models
- Add caching mechanisms to improve efficiency
  - Cache model data to reduce redundant API calls
  - Manage cache expiration with timestamps and time-to-live settings
- Update status line to reflect ongoing background operations
- Ensure smooth user interaction by minimizing wait times and enhancing performance

* Features

See [[file:README-features.org]] for a deeper delve into each feature as it was added.

- *Minimal Setup*
  
If desired, the following will get you going! (of course, have =ollama= running with some models loaded).
    
  #+begin_src elisp
   (use-package ollama-buddy
     :ensure t
     :bind
     ("C-c o" . ollama-buddy-menu)
     ("C-c O" . ollama-buddy-transient-menu-wrapper))
  #+end_src

- *Interactive Command Menu*
  
  - Quick-access menu with single-key commands (=M-x ollama-buddy-menu=)
  - Quickly define your own menu using =defcustom= with dynamic adaptable menu
  - Menu Presets easily definable in text files
  - Quickly switch between LLM models with no configuration required
  - Send text from any Emacs buffer
  - Each model is uniquely colored to enhance visual feedback
  - Switch between basic and advanced interface levels (=C-c A=)

- *Role and Session Management*

  - Create, switch, save and manage role-specific command menu configurations
  - Create, switch, save and manage sessions to provide chat/model based context
  - Prompt history/context with the ability to clear, turn on and off and save as part of a session file
  - Edit conversation history with intuitive keybindings

- *Smart Model Management*
  
  - Models can be assigned to individual menu commands
  - Intelligent model fallback
  - Real-time model availability monitoring
  - Easy model switching during sessions

- *Parameter Control*

  - Comprehensive parameter management for all Ollama API options
  - Temperature control for adjusting AI creativity
  - Command-specific parameter customization for optimized interactions
  - Visual parameter interface showing active and modified values

- *System Prompt Support*

  - Set persistent system prompts for guiding AI responses
  - Command-specific system prompts for tailored interactions
  - Visual indicators for active system prompts

- *AI Operations*
  
  - Code refactoring with context awareness
  - Automatic git commit message generation
  - Code explanation and documentation
  - Text operations (proofreading, conciseness, dictionary lookups)
  - Custom prompt support for flexibility

- *Conversation Tools*

  - Conversation history tracking and navigation
  - Real-time token usage tracking and statistics
  - Multi-model comparison (send prompts to multiple models)
  - Markdown to Org conversion for better formatting
  - Export conversations in various formats

- *Lightweight*
  
  - Single package file
  - A minified version =ollama-buddy-mini= (200 lines) is available
  - No external dependencies (curl not used)

* Transient Menu

Ollama Buddy now includes a transient-based menu system to improve usability and streamline interactions. Yes, I originally stated that I would never do it, but I think it compliments my crafted simple textual menu and the fact that I have now defaulted the main chat interface to a simple menu.

This can give the user more options for configuration, they can use the chat in advanced mode where the keybindings are presented in situ, or a more minimal basic setup where the transient menu can be activated.  For my use-package definition I current have the following set up, with the two styles of menus sitting alongside each other :

  #+begin_src elisp
  :bind
  ("C-c o" . ollama-buddy-menu)
  ("C-c O" . ollama-buddy-transient-menu)
  #+end_src

The new menu provides an organized interface for accessing the assistant’s core functions, including chat, model management, roles, and Fabric patterns. This post provides an overview of the features available in the Ollama Buddy transient menus.

Yes that's right also =fabric= patterns!, I have decided to add in auto syncing of the patterns directory in https://github.com/danielmiessler/fabric

Simply I pull the patterns directory which contain prompt guidance for a range of different topics and then push them through a completing read to set the =ollama-buddy= system prompt, so a special set of curated prompts can now be applied right in the =ollama-buddy= chat!

Anyways, here is a description of the transient menu system.

** What is the Transient Menu?

The transient menu in Ollama Buddy leverages Emacs' =transient.el= package (the same technology behind Magit's popular interface) to create a hierarchical, discoverable menu system. This approach transforms the user experience from memorizing numerous keybindings to navigating through logical groups of commands with clear descriptions.

** Accessing the Menu

The main transient menu can be accessed with the keybinding =C-c O= when in an Ollama Buddy chat buffer. You can also call it via =M-x ollama-buddy-transient-menu= from anywhere in Emacs.

** What the Menu Looks Like

When called, the main transient menu appears at the bottom of your Emacs frame, organized into logical sections with descriptive prefixes. Here's what you'll see:

#+begin_src 
|o(Y)o| Ollama Buddy
[Chat]             [Prompts]            [Model]               [Roles & Patterns]
o  Open Chat       l  Send Region       W  Manage Models      R  Switch Roles
O  Commands        s  Set System Prompt m  Switch Model       E  Create New Role
RET Send Prompt    C-s Show System      v  View Model Status  D  Open Roles Directory
h  Help/Menu       r  Reset System      i  Show Model Info    f  Fabric Patterns
k  Kill/Cancel     b  Ollama Buddy Menu M  Multishot          t  OpenAI Integration
x  Toggle Streaming

[Display Options]          [History]              [Sessions]             [Parameters]
A  Toggle Interface Level  H  Toggle History      N  New Session         P  Edit Parameter
B  Toggle Debug Mode       X  Clear History       L  Load Session        G  Display Parameters
T  Toggle Token Display    J  Edit History        S  Save Session        I  Parameter Help
u  Token Stats                                    Q  List Sessions       K  Reset Parameters
U  Token Usage Graph                              Z  Delete Session      F  Toggle Params in Header
C-o Toggle Markdown->Org                                                 p  Parameter Profiles
c  Toggle Model Colors                                                   
#+end_src

This visual layout makes it easy to discover and access the full range of Ollama Buddy's functionality. Let's explore each section in detail.

** Menu Sections Explained

*** Chat Section

This section contains the core interaction commands:

- *Open Chat (o)*: Opens the Ollama Buddy chat buffer
- *Commands (O)*: Opens a submenu with specialized commands
- *Send Prompt (RET)*: Sends the current prompt to the model
- *Help/Menu (h)*: Displays the help assistant with usage tips
- *Kill/Cancel Request (k)*: Cancels the current ongoing request
- *Toggle Streaming (x)*: Toggle streaming on and off only for ollama models

*** Prompts Section

These commands help you manage and send prompts:

- *Send Region (l)*: Sends the selected region as a prompt
- *Set System Prompt (s)*: Sets the current prompt as a system prompt
- *Show System Prompt (C-s)*: Displays the current system prompt
- *Reset System Prompt (r)*: Resets the system prompt to default
- *Ollama Buddy Menu (b)*: Opens the classic custom menu interface

*** Model Section

Commands for model management:

- *Manage Models*: Info, Pull, Copy, Delete for each model, plus Import GGUF Model and Pull any model from ollama library
- *Switch Model (m)*: Changes the active LLM
- *View Model Status (v)*: Shows status of all available models
- *Show Model Info (i)*: Displays detailed information about the current model
- *Multishot (M)*: Sends the same prompt to multiple models

*** Roles & Patterns Section

These commands help manage roles and use fabric patterns:

- *Switch Roles (R)*: Switch to a different predefined role
- *Create New Role (E)*: Create a new role interactively
- *Open Roles Directory (D)*: Open the directory containing role definitions
- *Fabric Patterns (f)*: Opens the submenu for Fabric patterns
- *OpenAI Integration (t)*: Opens menu specifically for OpenAI/ChatGPT

When you select the Fabric Patterns option, you'll see a submenu like this:

#+begin_src 
Fabric Patterns (42 available, last synced: 2025-03-18 14:30)
[Actions]             [Sync]              [Categories]          [Navigation]
s  Send with Pattern  S  Sync Latest      u  Universal Patterns q  Back to Main Menu
p  Set as System      P  Populate Cache   c  Code Patterns
l  List All Patterns  I  Initial Setup    w  Writing Patterns
v  View Pattern Details                   a  Analysis Patterns
#+end_src

*** Display Options Section

Commands to customize the display:

- *Toggle Interface Level (A)*: Switch between basic and advanced interfaces
- *Toggle Debug Mode (B)*: Enable/disable JSON debug information
- *Toggle Token Display (T)*: Show/hide token usage statistics
- *Display Token Stats (U)*: Show detailed token usage information
- *Toggle Markdown->Org (C-o)*: Enable/disable conversion to Org format
- *Toggle Model Colors (c)*: Enable/disable model-specific colors
- *Token Usage Graph (g)*: Display a visual graph of token usage

*** History Section

Commands for managing conversation history:

- *Toggle History (H)*: Enable/disable conversation history
- *Clear History (X)*: Clear the current history
- *Edit History (J)*: Edit the history in a buffer

*** Sessions Section

Commands for session management:

- *New Session (N)*: Start a new session
- *Load Session (L)*: Load a saved session
- *Save Session (S)*: Save the current session
- *List Sessions (Q)*: List all available sessions
- *Delete Session (Z)*: Delete a saved session

*** Parameters Section

Commands for managing model parameters:

- *Edit Parameter (P)*: Opens a submenu to edit specific parameters
- *Display Parameters (G)*: Show current parameter settings
- *Parameter Help (I)*: Display help information about parameters
- *Reset Parameters (K)*: Reset parameters to defaults
- *Toggle Params in Header (F)*: Show/hide parameters in header
- *Parameter Profiles (p)*: Opens the parameter profiles submenu

When you select the Edit Parameter option, you'll see a comprehensive submenu of all available parameters:

#+begin_src 
Parameters
[Generation]                [More Generation]          [Mirostat]
t  Temperature              f  Frequency Penalty       M  Mirostat Mode
k  Top K                    s  Presence Penalty        T  Mirostat Tau
p  Top P                    n  Repeat Last N           E  Mirostat Eta
m  Min P                    x  Stop Sequences
y  Typical P                l  Penalize Newline
r  Repeat Penalty

[Resource]                  [More Resource]            [Memory]
c  Num Ctx                  P  Num Predict             m  Use MMAP
b  Num Batch                S  Seed                    L  Use MLOCK
g  Num GPU                  N  NUMA                    C  Num Thread
G  Main GPU                 V  Low VRAM
K  Num Keep                 o  Vocab Only

[Profiles]                  [Actions]
d  Default Profile          D  Display All
a  Creative Profile         R  Reset All
e  Precise Profile          H  Help
A  All Profiles             F  Toggle Display in Header
                            q  Back to Main Menu
#+end_src

** Parameter Profiles

Ollama Buddy includes predefined parameter profiles that can be applied with a single command. When you select "Parameter Profiles" from the main menu, you'll see:

#+begin_src 
Parameter Profiles
Current modified parameters: temperature, top_k, top_p
[Available Profiles]
d  Default
c  Creative
p  Precise

[Actions]
q  Back to Main Menu
#+end_src

** Commands Submenu

The Commands submenu provides quick access to specialized operations:

#+begin_src 
Ollama Buddy Commands
[Code Operations]       [Language Operations]    [Pattern-based]         [Custom]
r  Refactor Code        l  Dictionary Lookup     f  Fabric Patterns      C  Custom Prompt
d  Describe Code        s  Synonym Lookup        u  Universal Patterns   m  Minibuffer Prompt
g  Git Commit Message   p  Proofread Text        c  Code Patterns

[Actions]
q  Back to Main Menu
#+end_src

** Direct Keybindings

For experienced users who prefer direct keybindings, all transient menu functions can also be accessed through keybindings with the prefix of your choice (or =C-c O= when in the chat minibuffer) followed by the key shown in the menu. For example:

- =C-c O s= - Set system prompt
- =C-c O m= - Switch model
- =C-c O P= - Open parameter menu

** Customization

The transient menu can be customized by modifying the =transient-define-prefix= definitions in the package. You can add, remove, or rearrange commands to suit your workflow.

* Screenshots / Demos

Note that all the demos are in real time.

** youtube

Also these videos will all be uploaded to a youtube channel:

https://www.youtube.com/@OllamaBuddyforEmacs

*** description

Demonstrating the Emacs package ollama-buddy, providing a convenient way to integrate Ollama's local LLM capabilities.

https://melpa.org/#/ollama-buddy
https://github.com/captainflasmr/ollama-buddy

#emacs #ollama

** 001 First Steps

- Starting with model : llama3.2:1b
- Show menu activation C-c o =ollama-buddy-menu=
- [o] Open chat buffer
- PROMPT:: why is the sky blue?
- C-c C-c to send from chat buffer
- From this demo README file, select the following text and send to chat buffer:
  What is the capital of France?

#+attr_org: :width 300px
#+attr_html: :width 100%
[[file:img/ollama-buddy-screen-recording_001.gif]]

** 002 Swap Models

- C-c m to swap to differing models from chat buffer
- Select models from the intro message
- Swap models from the transient menu
- PROMPT:: how many fingers do I have?

#+attr_org: :width 300px
#+attr_html: :width 100%
[[file:img/ollama-buddy-screen-recording_002.gif]]

** 003 From Other Buffers

the quick brown fox jumps over the lazy dog
- Select individual words for dictionary menu items
- Select whole sentence and convert to uppercase

#+attr_org: :width 300px
#+attr_html: :width 100%
[[file:img/ollama-buddy-screen-recording_003.gif]]

** 004 Coding - Writing a Hello World! program with increasingly advanced models

- PROMPT:: can you write a hello world program in Ada?
- switch models to the following and check differing output:
  - tinyllama:latest
  - qwen2.5-coder:3b
  - qwen2.5-coder:7b

#+attr_org: :width 300px
#+attr_html: :width 100%
[[file:img/ollama-buddy-screen-recording_004.gif]]

** 005 006 Roald Dahl to Buffy! using a custom menu - just for fun!

In fairy-tales, witches always wear silly black hats and black coats, and they ride on broomsticks. But this is not a fairy-tale. This is about REAL WITCHES.

Lets change roles into a Buffy preset and have some fun!

- *Cordelia burn*

#+attr_org: :width 300px
#+attr_html: :width 100%
[[file:img/ollama-buddy-screen-recording_005.gif]]

- *Giles... yawn!*

#+attr_org: :width 300px
#+attr_html: :width 100%
[[file:img/ollama-buddy-screen-recording_006.gif]]

** 007 Multishot

- PROMPT:: how many fingers do I have?
- send to multiple models, any difference in output?
- Also they are now available in the equivalent letter named registers, so lets pull those registers!

#+attr_org: :width 300px
#+attr_html: :width 100%
[[file:img/ollama-buddy-screen-recording_007.gif]]  

** 008 Role Switching

Show the changing of roles and how they affect the menu and hence the commands available.

#+attr_org: :width 300px
#+attr_html: :width 100%
[[file:img/ollama-buddy-screen-recording_008.gif]]  

** 009 Prompt History

Enter a few queries to test the system, then navigate back through your previous inputs, switch models, and resubmit to compare results.

#+attr_org: :width 300px
#+attr_html: :width 100%
[[file:img/ollama-buddy-screen-recording_009.gif]]  

** 012 Sessions/History and recall

- Ask:
What is the capital of France?
and of Italy?
- Turn off history
and of Germany?
- Turn on history
and of Germany?
- Save Session
- Restart Emacs
- Load Session
and of Sweden?

#+attr_org: :width 300px
#+attr_html: :width 100%
[[file:img/ollama-buddy-screen-recording_012.gif]]

** 015 System prompt support

Set the system message to:
You must always respond in a single sentence.
Now ask the following:
Tell me why Emacs is so great!
Tell me about black holes
clear the system message and ask again, the reponses should now be more verbose!!

#+attr_org: :width 300px
#+attr_html: :width 100%
[[file:img/ollama-buddy-screen-recording_015.gif]]

** Advanced parameter options

*** Get the same response each time using *seed*

Set the seed using edit parameters to 50
Send the same prompt and see the same response!!

* Installation

** Prerequisites

- [[https://ollama.ai/][Ollama]] installed and running locally
- Emacs 26.1 or later

** MELPA

#+begin_src emacs-lisp
   (use-package ollama-buddy
     :ensure t
     :bind
     ("C-c o" . ollama-buddy-menu)
     ("C-c O" . ollama-buddy-transient-menu-wrapper))
#+end_src

** Manual Installation

Clone this repository:

#+begin_src shell
git clone https://github.com/captainflasmr/ollama-buddy.git
#+end_src

*** init.el

With the option to add your own user keybinding for the =ollama-buddy-menu=

#+begin_src emacs-lisp
(add-to-list 'load-path "path/to/ollama-buddy")
(require 'ollama-buddy)
(global-set-key (kbd "C-c o") #'ollama-buddy-menu)
(global-set-key (kbd "C-c O") #'ollama-buddy-transient-menu-wrapper)
#+end_src

OR

#+begin_src elisp
 (use-package ollama-buddy
   :load-path "path/to/ollama-buddy"
   :bind
   ("C-c o" . ollama-buddy-menu)
   ("C-c O" . ollama-buddy-transient-menu-wrapper))
#+end_src

- Usage

1. Start your Ollama server locally with =ollama serve=
2. In Emacs, =M-x ollama-buddy-menu= or a user defined keybinding =C-c o= to open up the ollama buddy menu
3. Select [o] to open and jump to the chat buffer
4. Read the AI assistants greeting and off you go!

** Key Bindings in Chat Buffer

| Key             | Action                                  |
|-----------------+-----------------------------------------|
| C-c C-c         | Send prompt                             |
| C-c k           | Cancel request                          |
| C-c m           | Change model                            |
| C-c h           | Show help                               |
| C-c i           | Show model info                         |
| C-c U           | Show token statistics                   |
| C-c U           | Show token graph                        |
| C-c C-s         | Show system prompt                      |
| C-u C-c C-c     | Set system prompt                       |
| C-u C-u C-c C-c | Clear system prompt                     |
| M-p / M-n       | Browse prompt history                   |
| C-c n / C-c p   | Navigate between prompts                |
| C-c N           | New session                             |
| C-c L           | Load session                            |
| C-c S           | Save session                            |
| C-c Y           | List sessions                           |
| C-c W           | Delete session                          |
| C-c H           | Toggle history                          |
| C-c X           | Clear history                           |
| C-c E           | Edit history                            |
| C-c l           | Prompt to multiple models               |
| C-c P           | Edit parameters                         |
| C-c G           | Show parameters                         |
| C-c I           | Show parameter help                     |
| C-c K           | Reset parameters                        |
| C-c D           | Toggle JSON debug mode                  |
| C-c T           | Toggle token display                    |
| C-c Z           | Toggle parameters                       |
| C-c C-o         | Toggle Markdown/Org format              |
| C-c A           | Toggle interface level (basic/advanced) |

** Default Menu Items

The default menu offers the following menu items:

| Key | Action                      | Description                 |
|-----+-----------------------------+-----------------------------|
| o   | Open chat buffer            | Open chat buffer            |
| m   | Swap model                  | Swap model                  |
| v   | View model status           | View model status           |
| l   | Send region                 | Send region                 |
| R   | Switch roles                | Switch roles                |
| N   | Create new role             | Create new role             |
| D   | Open roles directory        | Open roles directory        |
| r   | Refactor code               | Refactor code               |
| g   | Git commit message          | Git commit message          |
| c   | Describe code               | Describe code               |
| d   | Dictionary Lookup           | Dictionary Lookup           |
| n   | Word synonym                | Word synonym                |
| p   | Proofread text              | Proofread text              |
| e   | Custom prompt               | Custom prompt               |
| i   | Minibuffer Prompt           | Minibuffer Prompt           |
| K   | Delete session              | Delete session              |
| q   | Quit                        | Quit                        |

* Core Features in Detail

** Chat Interface

The ollama-buddy chat buffer is powered by =org-mode=, providing enhanced readability and structure. Conversations automatically format user prompts and AI responses with org-mode headings, making them easier to navigate and utilize.

Benefits include:
- Outlining and heading navigation
- Org export capabilities
- Source code fontification

Toggle Markdown to Org conversion with =C-c C-o=.

** Interface Levels

You can choose between two interface levels depending on your preference:

- *Basic Interface*: Shows minimal commands for new users
- *Advanced Interface*: Shows all available commands and features

Set your preferred interface level:

#+begin_src elisp
(setq ollama-buddy-interface-level 'basic)  ; or 'advanced
#+end_src

By default, the menu is set to Basic. Switch between levels during your session with =C-c A=.

** Conversation History

Ollama Buddy maintains context between your interactions by:

- Tracking conversation history between prompts and responses
- Sending previous messages to Ollama for improved contextual responses
- Displaying a history counter in the status line showing conversation length
- Providing configurable history length limits to control memory usage

Control this feature with:

#+begin_src elisp
;; Enable/disable conversation history (default: t)
(setq ollama-buddy-history-enabled t)

;; Set maximum conversation pairs to remember (default: 10)
(setq ollama-buddy-max-history-length 10)

;; Show/hide the history counter in the header line (default: t)
(setq ollama-buddy-show-history-indicator t)
#+end_src

History-related commands:
- =C-c H=: Toggle history tracking on/off
- =C-c X=: Clear the current conversation history
- =C-c E=: Edit conversation history (universal argument to edit specific model)

** Parameter Management

Comprehensive parameter management gives you complete control over your Ollama model's behavior through API options:

- *All Parameters* - Set any custom option for the Ollama LLM at runtime
- *Smart Parameter Management*: Only modified parameters are sent to Ollama, preserving defaults
- *Visual Parameter Interface*: Clear display showing which parameters are active with highlighting

Access parameter management through keyboard shortcuts:
- =C-c P= - Edit a parameter
- =C-c G= - Display current parameters
- =C-c I= - Show parameter help
- =C-c K= - Reset parameters to defaults

** Command-Specific Parameters

You can define specific parameter sets for each command in the menu, enabling optimization for particular use cases:

#+begin_src elisp
;; Update properties and parameters at once
(ollama-buddy-update-command-with-params 'describe-code
 :model "codellama:latest"
 :parameters '((temperature . 0.3) (top_p . 0.8)))
#+end_src

This feature is particularly useful for:
1. *Code-related tasks*: Lower temperature for more deterministic code generation
2. *Creative writing*: Higher temperature for more varied and creative outputs
3. *Technical explanations*: Balanced settings for clear, accurate explanations
4. *Summarization tasks*: Custom parameters to control verbosity and focus

** System Prompt Support

Ollama Buddy supports system prompts, allowing you to set and manage system-level instructions for your AI interactions:

- *Set a system prompt*: Use =C-u C-c C-c= to designate any user prompt as a system prompt
- *Clear system prompt*: Use =C-u C-u C-c C-c= to clear the system prompt
- *View system prompt*: Use =C-c C-s= to display the current system prompt

System prompts remain active across user queries, providing better control over conversation context. The status bar displays an "S" indicator when a system prompt is active.

You can also define system prompts per command:

#+begin_src elisp
(ollama-buddy-update-menu-entry
 'refactor-code
 :model "qwen2.5-coder:7b"
 :system "You are an expert software engineer who improves code and only mainly using the principles exhibited by Ada")
#+end_src

** Token Usage Tracking

Real-time token tracking helps you monitor usage and performance:

- Track token counts, rates, and usage history
- Display token usage statistics (=C-c t= or menu option)
- Toggle token stats display after responses
- Real-time updates via timer

** Multi-model Comparison

With the multishot mode, you can send a prompt to multiple models in sequence and compare their responses:

- Models are assigned letters for quick selection (e.g., =(a) mistral=, =(b) gemini=)
- Use =C-c l= to initiate a multishot sequence
- Responses are stored in registers named after the assigned letters
- Status updates track progress during multishot execution

To use multishot mode:
1. =C-c l= to start a multishot session
2. Type a sequence of model letters (e.g., =abc= to use models a, b, and c)
3. The selected models process the prompt one by one
4. Responses are saved to registers for later recall

** Role-Based Presets

Roles in Ollama Buddy are essentially profiles tailored to specific tasks:

- Store custom roles in =ollama-buddy-roles-directory= (default: =~/.emacs.d/ollama-buddy-presets/=)
- Switch between roles with =M-x ollama-buddy-roles-switch-role= or menu option =R=
- Create custom roles with =M-x ollama-buddy-role-creator-create-new-role= or menu option =N=
- Open role directory with =M-x ollama-buddy-roles-open-directory= or menu option =D=

Preconfigured presets available:
- ollama-buddy--preset__buffy.el
- ollama-buddy--preset__default.el
- ollama-buddy--preset__emacs.el
- ollama-buddy--preset__developer.el
- ollama-buddy--preset__janeway.el
- ollama-buddy--preset__translator.el
- ollama-buddy--preset__writer.el

** Session Management

Session management allows you to save conversations and restore them with relevant context:

- *Save session* with =ollama-buddy-sessions-save= or =C-c S=
- *Load session* with =ollama-buddy-sessions-load= or =C-c L=
- *List sessions* with =ollama-buddy-sessions-list= or =C-c Y=
- *Delete session* with =ollama-buddy-sessions-delete= or =C-c K=
- *New session* with =ollama-buddy-sessions-new= or =C-c E=

Sessions preserve model-specific chat history to prevent context contamination across different models.

** Prompt History Support

Prompts are integrated into the Emacs history mechanism and persist across sessions:

- Use =M-p= to navigate prompt history in the chat buffer
- Use =M-p= / =M-n= within the minibuffer to insert previous prompts

* Customization

** Basic Customization

#+begin_src elisp
(use-package ollama-buddy
  :bind
  ("C-c o" . ollama-buddy-menu)
  ("C-c O" . ollama-buddy-transient-menu-wrapper)
  :custom
  ;; Set default model
  (ollama-buddy-default-model "llama3:latest")
  ;; Set interface level (basic or advanced)
  (ollama-buddy-interface-level 'advanced)
  ;; Enable model colors
  (ollama-buddy-enable-model-colors t)
  ;; Set menu columns
  (ollama-buddy-menu-columns 3))
#+end_src

** Remote Ollama Server

#+begin_src elisp
(use-package ollama-buddy
  :bind
  ("C-c o" . ollama-buddy-menu)
  ("C-c O" . ollama-buddy-transient-menu-wrapper)
  :custom
  (ollama-buddy-host "http://<remote-server>")
  (ollama-buddy-port 11400))
#+end_src

** Command-Specific Models

#+begin_src elisp
(use-package ollama-buddy
  :bind
  ("C-c o" . ollama-buddy-menu)
  ("C-c O" . ollama-buddy-transient-menu-wrapper)
  :config
  (ollama-buddy-add-model-to-menu-entry 'dictionary-lookup "tinyllama:latest")
  (ollama-buddy-add-model-to-menu-entry 'synonym "tinyllama:latest"))
#+end_src

** Command-Specific System Prompts

#+begin_src elisp
(use-package ollama-buddy
  :bind
  ("C-c o" . ollama-buddy-menu)
  ("C-c O" . ollama-buddy-transient-menu-wrapper)
  :config
  (ollama-buddy-update-menu-entry
   'refactor-code
   :model "qwen2.5-coder:7b"
   :system "You are an expert software engineer who improves code using Ada principles"))
#+end_src

** Variables

#+begin_src emacs-lisp :results table :colnames '("Custom variable" "Description") :exports results
  (let ((rows))
    (mapatoms
     (lambda (symbol)
       (when (and (string-match "^ollama-buddy-" (symbol-name symbol))
                  (not (string-match "--" (symbol-name symbol)))
                  (or (custom-variable-p symbol)
                      (boundp symbol)))
         (push `(,symbol
                 ,(car
                   (split-string
                    (or (get (indirect-variable symbol)
                             'variable-documentation)
                        (get symbol 'variable-documentation)
                        "")
                    "\n")))
               rows))))
    rows)
#+end_src

#+RESULTS:
| Custom variable                        | Description                                                                  |
|----------------------------------------+------------------------------------------------------------------------------|
| ollama-buddy-openai-show-loading       | Whether to show a loading indicator during API requests.                     |
| ollama-buddy-command-definitions       | Comprehensive command definitions for Ollama Buddy.                          |
| ollama-buddy-enable-model-colors       | Whether to show model colors.                                                |
| ollama-buddy-interface-level           | Level of interface complexity to display.                                    |
| ollama-buddy-show-params-in-header     | Whether to show modified parameters in the header line.                      |
| ollama-buddy-debug-mode                | When non-nil, show raw JSON messages in a debug buffer.                      |
| ollama-buddy-auto-save-session-name    | Name to use for auto-saved sessions.                                         |
| ollama-buddy-mode                      | Non-nil if Ollama-Buddy mode is enabled.                                     |
| ollama-buddy-sessions-directory        | Directory containing ollama-buddy session files.                             |
| ollama-buddy-menu-columns              | Number of columns to display in the Ollama Buddy menu.                       |
| ollama-buddy-fabric-pattern-categories | List of pattern categories to focus on when listing patterns.                |
| ollama-buddy-status-update-interval    | Interval in seconds to update the status line with background operations.    |
| ollama-buddy-fabric-update-on-startup  | Whether to automatically update patterns when Emacs starts.                  |
| ollama-buddy-available-models          | List of available models to pull from Ollama Hub.                            |
| ollama-buddy-claude-max-tokens         | Maximum number of tokens to generate in the response.                        |
| ollama-buddy-openai-models             | List of available OpenAI models.                                             |
| ollama-buddy-openai-marker-prefix      | Prefix to indicate that a model is from OpenAI rather than Ollama.           |
| ollama-buddy-history-enabled           | Whether to use conversation history in Ollama requests.                      |
| ollama-buddy-claude-marker-prefix      | Prefix used to identify Claude models in the model list.                     |
| ollama-buddy-roles-directory           | Directory containing ollama-buddy role preset files.                         |
| ollama-buddy-fabric-local-dir          | Local directory where Fabric patterns will be stored.                        |
| ollama-buddy-show-history-indicator    | Whether to show the history indicator in the header line.                    |
| ollama-buddy-mode-map                  | Keymap for ollama-buddy mode.                                                |
| ollama-buddy-claude-models             | List of available Claude models.                                             |
| ollama-buddy-fabric-patterns-subdir    | Subdirectory within the Fabric repo containing the patterns.                 |
| ollama-buddy-openai-api-endpoint       | Endpoint for OpenAI chat completions API.                                    |
| ollama-buddy-params-active             | Currently active values for Ollama API parameters.                           |
| ollama-buddy-openai-default-model      | Default OpenAI model to use.                                                 |
| ollama-buddy-claude-default-model      | Default Claude model to use.                                                 |
| ollama-buddy-claude-show-loading       | Whether to show a loading indicator during API requests.                     |
| ollama-buddy-params-modified           | Set of parameters that have been explicitly modified by the user.            |
| ollama-buddy-host                      | Host where Ollama server is running.                                         |
| ollama-buddy-auto-save-session         | Whether to automatically save session on exit.                               |
| ollama-buddy-streaming-enabled         | Whether to use streaming mode for responses.                                 |
| ollama-buddy-max-history-length        | Maximum number of message pairs to keep in conversation history.             |
| ollama-buddy-default-model             | Default Ollama model to use.                                                 |
| ollama-buddy-claude-temperature        | Temperature setting for Claude requests (0.0-1.0).                           |
| ollama-buddy-display-token-stats       | Whether to display token usage statistics in responses.                      |
| ollama-buddy-claude-api-endpoint       | Endpoint for Anthropic Claude API.                                           |
| ollama-buddy-openai-max-tokens         | Maximum number of tokens to generate in the response.                        |
| ollama-buddy-claude-api-key            | API key for accessing Anthropic Claude services.                             |
| ollama-buddy-params-profiles           | Predefined parameter profiles for different usage scenarios.                 |
| ollama-buddy-params-defaults           | Default values for Ollama API parameters.                                    |
| ollama-buddy-port                      | Port where Ollama server is running.                                         |
| ollama-buddy-default-register          | Default register to store the current response when not in multishot mode.   |
| ollama-buddy-after-load-hook           |                                                                              |
| ollama-buddy-fabric-repo-url           | URL of the Fabric GitHub repository.                                         |
| ollama-buddy-connection-check-interval | Interval in seconds to check Ollama connection status.                       |
| ollama-buddy-modelfile-directory       | Directory for storing temporary Modelfiles.                                  |
| ollama-buddy-openai-temperature        | Temperature setting for OpenAI requests (0.0-2.0).                           |
| ollama-buddy-convert-markdown-to-org   | Whether to automatically convert markdown to `org-mode' format in responses. |
| ollama-buddy-mode-hook                 | Hook run after entering or leaving `ollama-buddy-mode'.                      |
| ollama-buddy-openai-api-key            | API key for accessing OpenAI services.                                       |

* Interactive functions

#+begfin_src emacs-lisp :results table :colnames '("Command" "Description") :exports results
  (let ((rows))
    (mapatoms
     (lambda (symbol)
       (when (and (string-match "^ollama-buddy-" (symbol-name symbol))
                  (not (string-match "--" (symbol-name symbol)))
                  (commandp symbol))  ;; Check if it's an interactive command
         (push `(,symbol
                 ,(car
                   (split-string
                    (or (documentation symbol)
                        "")
                    "\n")))
               rows))))
    rows)
#+end_src

#+RESULTS:
| Command                                   | Description                                                                            |
|-------------------------------------------+----------------------------------------------------------------------------------------|
| ollama-buddy-toggle-markdown-conversion   | Toggle automatic conversion of markdown to ‘org-mode’ format.                          |
| ollama-buddy-reset-system-prompt          | Reset the system prompt to default (none).                                             |
| ollama-buddy-mode                         | Minor mode for ollama-buddy keybindings.                                               |
| ollama-buddy-roles-switch-role            | Switch to a different ollama-buddy role.                                               |
| ollama-buddy-history-edit                 | Edit the conversation history in a buffer.                                             |
| ollama-buddy-previous-history             | Navigate to previous item in prompt history.                                           |
| ollama-buddy-toggle-params-in-header      | Toggle display of modified parameters in the header line.                              |
| ollama-buddy-toggle-token-display         | Toggle display of token statistics after each response.                                |
| ollama-buddy-show-raw-model-info          | Retrieve and display raw JSON information about the current default model.             |
| ollama-buddy-history-cancel               | Cancel editing the history.                                                            |
| ollama-buddy-sessions-load                | Load a saved conversation session.                                                     |
| ollama-buddy-sessions-list                | Display a list of saved sessions.                                                      |
| ollama-buddy-params-help                  | Display help for Ollama parameters.                                                    |
| ollama-buddy-sessions-new                 | Start a new session by clearing history and buffer.                                    |
| ollama-buddy-show-system-prompt           | Display the current system prompt in a buffer.                                         |
| ollama-buddy-params-edit                  | Edit a specific parameter PARAM interactively.                                         |
| ollama-buddy-toggle-debug-mode            | Toggle display of raw JSON messages in a debug buffer.                                 |
| ollama-buddy-toggle-model-colors          | Toggle the use of model-specific colors in ollama-buddy.                               |
| ollama-buddy-reset-all-prompts            | Reset both system prompt and suffix to default (none).                                 |
| ollama-buddy-toggle-history               | Toggle conversation history on/off.                                                    |
| ollama-buddy-display-token-stats          | Display token usage statistics.                                                        |
| ollama-buddy-role-creator-create-new-role | Create a new role interactively.                                                       |
| ollama-buddy-roles-open-directory         | Open the ollama-buddy roles directory in Dired.                                        |
| ollama-buddy-params-reset                 | Reset all parameters to default values and clear modification tracking.                |
| ollama-buddy-menu                         | Display Ollama Buddy menu.                                                             |
| ollama-buddy-display-history              | Display the conversation history in a buffer.                                          |
| ollama-buddy-history-edit-model           | Edit the conversation history for a specific MODEL.                                    |
| ollama-buddy-roles-create-directory       | Create the ollama-buddy roles directory if it doesn’t exist.                           |
| ollama-buddy-history-save-model           | Save the edited history for MODEL back to ollama-buddy--conversation-history-by-model. |
| ollama-buddy-reset-suffix                 | Reset the suffix to default (none).                                                    |
| ollama-buddy-show-model-status            | Display status of models referenced in command definitions with color coding.          |
| ollama-buddy-next-history                 | Navigate to next item in prompt history.                                               |
| ollama-buddy-clear-history                | Clear the conversation history.                                                        |
| ollama-buddy-sessions-delete              | Delete a saved session.                                                                |
| ollama-buddy-set-suffix                   | Set the current prompt as a suffix.                                                    |
| ollama-buddy-set-system-prompt            | Set the current prompt as a system prompt.                                             |
| ollama-buddy-history-save                 | Save the edited history back to ollama-buddy--conversation-history-by-model.           |
| ollama-buddy-toggle-interface-level       | Toggle between basic and advanced interface levels.                                    |
| ollama-buddy-params-display               | Display the current Ollama parameter settings.                                         |
| ollama-buddy-sessions-save                | Save the current conversation state to a session file.                                 |

* Customizing the Ollama Buddy Menu System

Ollama Buddy provides a flexible menu system that can be easily customized to match your workflow. The menu is built from =ollama-buddy-command-definitions=, which you can modify or extend in your Emacs configuration.

** Basic Structure

Each menu item is defined using a property list with these key attributes:

#+begin_src elisp
(command-name
 :key ?k              ; Character for menu selection
 :description "desc"  ; Menu item description
 :model "model-name"  ; Specific Ollama model (optional)
 :prompt "prompt"     ; System prompt (optional)
 :system "system"     ; System prompt (optional)
 :parameters ((param . value)) ; Command-specific parameters (optional)
 :action function)    ; Command implementation
#+end_src

** Examples

*** Adding New Commands

You can add new commands to =ollama-buddy-command-definitions= in your config:

#+begin_src elisp
;; Add a single new command
(add-to-list 'ollama-buddy-command-definitions
               '(pirate
                 :key ?i
                 :description "R Matey!"
                 :model "mistral:latest"
                 :prompt "Translate the following as if I was a pirate:"
                 :action (lambda () (ollama-buddy--send-with-command 'pirate))))

;; Incorporate into a use-package
(use-package ollama-buddy
  :load-path "path/to/ollama-buddy"
  :bind
  ("C-c o" . ollama-buddy-menu)
  ("C-c O" . ollama-buddy-transient-menu-wrapper)
  (add-to-list 'ollama-buddy-command-definitions
               '(pirate
                 :key ?i
                 :description "R Matey!"
                 :model "mistral:latest"
                 :prompt "Translate the following as if I was a pirate:"
                 :action (lambda () (ollama-buddy--send-with-command 'pirate))))
  :custom ollama-buddy-default-model "llama:latest")

;; Add multiple commands at once
(setq ollama-buddy-command-definitions
      (append ollama-buddy-command-definitions
              '((summarize
                 :key ?u
                 :description "Summarize text"
                 :model "tinyllama:latest"
                 :prompt "Provide a brief summary:"
                 :action (lambda () 
                          (ollama-buddy--send-with-command 'summarize)))
                (translate-spanish
                 :key ?t
                 :description "Translate to Spanish"
                 :model "mistral:latest"
                 :prompt "Translate this text to Spanish:"
                 :action (lambda () 
                          (ollama-buddy--send-with-command 'translate-spanish))))))
#+end_src

*** Creating a Minimal Setup

You can create a minimal configuration by defining only the commands you need:

#+begin_src elisp
;; Minimal setup with just essential commands
(setq ollama-buddy-command-definitions
      '((send-basic
         :key ?l
         :description "Send Basic Region"
         :action (lambda () (ollama-buddy--send-with-command 'send-basic)))

        (quick-define
         :key ?d
         :description "Define word"
         :model "tinyllama:latest"
         :prompt "Define this word:"
         :action (lambda () 
                  (ollama-buddy--send-with-command 'quick-define)))
        (quit
         :key ?q
         :description "Quit"
         :model nil
         :action (lambda () 
                  (message "Quit Ollama Shell menu.")))))
#+end_src

** Tips for Custom Commands

1. Choose unique keys for menu items
2. Match models to task complexity (small models for quick tasks)
3. Use clear, descriptive names

** Command Properties Reference

| Property     | Description                              | Required |
|--------------+------------------------------------------+----------|
| :key         | Single character for menu selection      | Yes      |
| :description | Menu item description                    | Yes      |
| :model       | Specific Ollama model to use             | No       |
| :prompt      | Static system prompt                     | No       |
| :system      | System-level instruction                 | No       |
| :parameters  | Command-specific parameters              | No       |
| :action      | Function implementing the command        | Yes      |

- Model Selection and Fallback Logic

** Overview

You can associate specific commands defined in the menu with an Ollama LLM to optimize performance for different tasks. For example, if speed is a priority over accuracy, such as when retrieving synonyms, you might use a lightweight model like TinyLlama or a 1B–3B model. On the other hand, for tasks that require higher precision, like code refactoring, a more capable model such as Qwen-Coder 7B can be assigned to the "refactor" command on the buddy menu system.

Since this package enables seamless model switching through Ollama, the buddy menu can present a list of commands, each linked to an appropriate model. All Ollama interactions share the same chat buffer, ensuring that menu selections remain consistent. Additionally, the status bar on the header line and the prompt itself indicate the currently active model.

Ollama Buddy also includes a model selection mechanism with a fallback system to ensure commands execute smoothly, even if the preferred model is unavailable.

** Command-Specific Models

Commands in =ollama-buddy-command-definitions= can specify preferred models using the =:model= property. This allows optimizing different commands for specific models:

#+begin_src elisp
(defcustom ollama-buddy-command-definitions
  '((refactor-code
     :key ?r
     :description "Refactor code"
     :model "qwen-coder:latest"
     :prompt "refactor the following code:")
    (git-commit
     :key ?g
     :description "Git commit message"
     :model "tinyllama:latest"
     :prompt "write a concise git commit message for the following:")
    (send-region
     :key ?l
     :description "Send region"
     :model "llama:latest"))
  ...)
#+end_src

When =:model= is =nil=, the command will use whatever model is currently set as =ollama-buddy-default-model=.

** Fallback Chain

When executing a command, the model selection follows this fallback chain:

1. Command-specific model (=:model= property)
2. Current model (=ollama-buddy-default-model=)
3. User selection from available models

** Configuration Options

*** Setting the Fallback Model

#+begin_src elisp
(setq ollama-buddy-default-model "llama:latest")
#+end_src

** User Interface Feedback

When a fallback occurs, Ollama Buddy provides clear feedback:

- The header line shows which model is being used
- If using a fallback model, an orange warning appears showing both the requested and actual model
- The model status can be viewed using the "View model status" command (v key)

* Connection monitoring

Good ollama connection status visibility is maintained either by default using basic coding logic or if monitoring is desired then configure as thus:

By default, strategic status checks should be enough to indicate a good consistent ollama running state.

* Interactive functions

All interactive functions available in ollama-buddy are listed in the original README.

* ollama API Support Tables

** Core API

| API Endpoint    | Method | Purpose                            | Supported? | will ollama-buddy support?        |
|-----------------+--------+------------------------------------+------------+-----------------------------------|
| =/api/chat=     | POST   | Send chat messages to a model      | Yes        |                                   |
| =/api/generate= | POST   | Generate text without chat context | No         | Probably not, as chat covers      |
| =/api/delete=   | DELETE | Deletes available models           | Yes        |                                   |
| =/api/tags=     | GET    | List available models              | Yes        |                                   |
| =/api/pull=     | POST   | Pull a model from Ollama library   | Yes        |                                   |
| =/api/push=     | POST   | Push a model to the Ollama library | No         | No                                |
| =/api/create=   | POST   | Create a model from a Modelfile    | Yes        |                                   |
| =/api/show=     | POST   | Show model information             | Yes        |                                   |
| =/api/ps=       | GET    | List running models                | Yes        |                                   |
| =/api/copy=     | POST   | Copy a model                       | Yes        |                                   |
| =/api/embed=    | POST   | Generate embeddings from text      | No         | Probably when I can figure it out |
| =/api/version=  | GET    | Get Ollama version                 | Yes        |                                   |
| Cancel requests | Custom | Terminate ongoing request          | Yes        |                                   |

** Core Params

| Parameter    | Supported | Notes                                            | will ollama-buddy support? |
|--------------+-----------+--------------------------------------------------+----------------------------|
| =model=      | Yes       | Can be specified per command or globally         |                            |
| =prompt=     | Yes       | Core feature with extensive prompt handling      |                            |
| =suffix=     | Yes/No    | Can be set with =ollama-buddy-set-suffix=        |                            |
| =images=     | No        |                                                  | Unlikely, this is Emacs!   |
| =format=     | No        |                                                  | Maybe                      |
| =options=    | Yes       | Full implementation of all model parameters      |                            |
| =system=     | Yes       | Can be set with =ollama-buddy-set-system-prompt= |                            |
| =template=   | No        |                                                  | Maybe                      |
| =stream=     | Yes       | Toggleable with =ollama-buddy-toggle-streaming=  |                            |
| =raw=        | No        |                                                  | Might as well              |
| =keep_alive= | No        | Uses default Ollama behavior                     | Yes                        |

** Model Options Parameters 

| Parameter Group         | Parameters                                                                                     | Supported |
|-------------------------+------------------------------------------------------------------------------------------------+-----------|
| *Temperature Controls*  | =temperature=, =top_k=, =top_p=, =min_p=, =typical_p=                                          | Yes       |
| *Repetition Controls*   | =repeat_last_n=, =repeat_penalty=, =presence_penalty=, =frequency_penalty=                     | Yes       |
| *Advanced Sampling*     | =mirostat=, =mirostat_tau=, =mirostat_eta=, =penalize_newline=, =stop=                         | Yes       |
| *Resource Management*   | =num_keep=, =seed=, =num_predict=, =num_ctx=, =num_batch=                                      | Yes       |
| *Hardware Optimization* | =numa=, =num_gpu=, =main_gpu=, =low_vram=, =vocab_only=, =use_mmap=, =use_mlock=, =num_thread= | Yes       |

* Bugs                                                                 :bugs:

#+begin_src emacs-lisp :results table :exports results :tangle no
(my/kanban-to-table "bugs" "issues")
#+end_src

#+RESULTS:
| TODO                                                                         | DOING                                      | DONE                                                          |
|------------------------------------------------------------------------------+--------------------------------------------+---------------------------------------------------------------|
| transient-setup: Key sequence 1 0 starts with non-prefix key 1               | Kill online AI process with cancel request | =C-a= beginning-of-line to jump to prompt start like comint   |
| I think some hard coded Claude models currently don't work                   | GGUF to use new syncing option             | As shell generally C-n to end of list to clear prompt history |
| Claude request and connection can sometimes take time and it blocks!         |                                            | Add Texinfo to MELPA recipe                                   |
| Pushing hundreds or even thousands of lines to the chat buffer takes a while |                                            | System prompt not cleared on new session                      |
| Still some encoding issues on returns from online AI                         |                                            | Remove fabric from Commands transient menu                    |
| Conversation history to display with Claude/ChatGPT                          |                                            | External AI to copy to register                               |
| ChatGPT request/response too long                                            |                                            | First request with no chat buffer fails                       |
| Check tags caching                                                           |                                            |                                                               |
| Save system prompts as part of session                                       |                                            |                                                               |
| keybindings in ollama chat buffer are reserved                               |                                            |                                                               |

** TODO transient-setup: Key sequence 1 0 starts with non-prefix key 1

** TODO I think some hard coded Claude models currently don't work

** TODO Claude request and connection can sometimes take time and it blocks!

** TODO Pushing hundreds or even thousands of lines to the chat buffer takes a while

For example large diffs, although a 4000 lines diff is unusual?

** TODO Still some encoding issues on returns from online AI

** TODO Conversation history to display with Claude/ChatGPT

** TODO ChatGPT request/response too long

[GPT gpt-3.5-turbo: RESPONSE]

Error: This model's maximum context length is 16385 tokens. However, you requested 20189 tokens (16093 in the messages, 4096 in the completion). Please reduce the length of the messages or completion.

** TODO Check tags caching

** DOING Kill online AI process with cancel request

** DOING GGUF to use new syncing option

For some reason this is more difficult than it looks

** TODO Save system prompts as part of session

** TODO keybindings in ollama chat buffer are reserved

#+begin_src 
2647:70: error: This key sequence is reserved (see Key Binding Conventions in the Emacs Lisp manual)
#+end_src

Do I even care?

** DONE =C-a= beginning-of-line to jump to prompt start like comint
CLOSED: [2025-04-09 Wed 13:12]

** DONE As shell generally C-n to end of list to clear prompt history
CLOSED: [2025-04-09 Wed 11:23]

** DONE Add Texinfo to MELPA recipe
CLOSED: [2025-04-01 Tue 20:24]

MELPA has automatically picked up the info file!

** DONE System prompt not cleared on new session
CLOSED: [2025-03-29 Sat 13:44]

** DONE Remove fabric from Commands transient menu
CLOSED: [2025-03-29 Sat 13:37]

** DONE External AI to copy to register
CLOSED: [2025-03-29 Sat 13:34]

** DONE First request with no chat buffer fails

* Roadmap                                                           :roadmap:

#+begin_src emacs-lisp :results table :exports results :tangle no
(my/kanban-to-table "roadmap" "issues")
#+end_src

#+RESULTS:
| TODO                                | DOING                              | DONE                                       |
|-------------------------------------+------------------------------------+--------------------------------------------|
| Autogenerate session save name      | Merge history buffer functionality | Method for securely storing API keys       |
| Add gemini?                         | Core Params - suffix               | Core API - Delete Model                    |
| Pull ChatGPT and Claude model names | Show incoming ollama messages      | Core API - Copy a model                    |
| Core API - Embeddings               | Add chatGPT awesome prompt support | Core API - stream                          |
| Core Params - format                | Add fabric pattern/prompt support  | Core API - Pull/Info/Pull/Delete a model   |
| Core Params - template              | ChatGPT support                    | Core API - Show running models             |
| Core Params - raw                   | Claude support                     | Core API - Create a model from a GGUF file |
| Test on Windows                     |                                    | Add transient menu                         |
|                                     |                                    | History editing                            |
|                                     |                                    | Core API - options - parameter editing     |
|                                     |                                    | Core API - show model information          |
|                                     |                                    | Core API - system prompt                   |
|                                     |                                    | Chat buffer to use org-mode                |
|                                     |                                    | Chat export options                        |
|                                     |                                    | Core Params - options:temperature          |
|                                     |                                    | Managing Sessions                          |
|                                     |                                    | Sparse minified version                    |
|                                     |                                    | Role-Based Menu Preset System              |
|                                     |                                    | Add to MELPA                               |
|                                     |                                    | Enhancing Menu Clarity                     |
|                                     |                                    | Real time token tracking                   |
|                                     |                                    | Managing chat history and context          |

** DOING Merge history buffer functionality

** TODO Autogenerate session save name

** TODO Add gemini?

** TODO Pull ChatGPT and Claude model names

** TODO Core API - Embeddings

** TODO Core Params - format

** TODO Core Params - template

** TODO Core Params - raw

** TODO Test on Windows

** DOING Core Params - suffix

I think this is only for generate, but I have quietly added it in.

** DOING Show incoming ollama messages

** DOING Add chatGPT awesome prompt support

** DOING Add fabric pattern/prompt support

** DONE Method for securely storing API keys
CLOSED: [2025-04-04 Fri 10:18]

Added to readme to advise to use Emacs built-in auth-source

** DOING ChatGPT support

** DOING Claude support

** DONE Core API - Delete Model

** DONE Core API - Copy a model

** DONE Core API - stream

** DONE Core API - Pull/Info/Pull/Delete a model

** DONE Core API - Show running models

** DONE Core API - Create a model from a GGUF file

** DONE Add transient menu

** DONE History editing

** DONE Core API - options - parameter editing

** DONE Core API - show model information

** DONE Core API - system prompt

** DONE Chat buffer to use org-mode

** DONE Chat export options

** DONE Core Params - options:temperature

** DONE Managing Sessions

** DONE Sparse minified version

** DONE Role-Based Menu Preset System

** DONE Add to MELPA

** DONE Enhancing Menu Clarity

** DONE Real time token tracking

** DONE Managing chat history and context

* Alternative LLM based packages

To the best of my knowledge, there are currently a few Emacs packages related to Ollama, though the ecosystem is still relatively young:

1. *llm.el* (by Andrew Hyatt)
   - A more general LLM interface package that supports Ollama as one of its backends
   - GitHub: https://github.com/ahyatt/llm
   - Provides a more abstracted approach to interacting with language models
   - Supports multiple backends including Ollama, OpenAI, and others

2. *gptel* (by Karthik Chikmagalur)
   - While primarily designed for ChatGPT and other online services, it has experimental Ollama support
   - GitHub: https://github.com/karthink/gptel
   - Offers a more integrated chat buffer experience
   - Has some basic Ollama integration, though it's not the primary focus

3. *chatgpt-shell* (by xenodium)
   - Primarily designed for ChatGPT, but has some exploration of local model support
   - GitHub: https://github.com/xenodium/chatgpt-shell
   - Not specifically Ollama-focused, but interesting for comparison

4. *ellama* (by s-kostyaev)
   - A comprehensive Emacs package for interacting with local LLMs through Ollama
   - GitHub: https://github.com/s-kostyaev/ellama
   - Features deep org-mode integration and extensive prompt templates
   - Offers streaming responses and structured interaction patterns
   - More complex but feature-rich approach to local LLM integration

* Alternative package comparison

Let's compare ollama-buddy to the existing solutions:

1. *llm.el*
   
   - *Pros*:
     
     - Provides a generic LLM interface
     - Supports multiple backends
     - More abstracted and potentially more extensible
       
   =ollama-buddy= is more:
   
   - Directly focused on Ollama
   - Lightweight and Ollama-native
   - Provides a more interactive, menu-driven approach
   - Simpler to set up for Ollama specifically

2. *gptel*
   
   - *Pros*:
     
     - Sophisticated chat buffer interface
     - Active development
     - Good overall UX
       
   =ollama-buddy= differentiates by:
   
   - Being purpose-built for Ollama
   - Offering a more flexible, function-oriented approach
   - Providing a quick, lightweight interaction model
   - Having a minimal, focused design

3. *chatgpt-shell*
   
   - *Pros*:
     
     - Mature shell-based interaction model
     - Rich interaction capabilities
       
   =ollama-buddy= stands out by:
   
   - Being specifically designed for Ollama
   - Offering a simpler, more direct interaction model
   - Providing a quick menu-based interface
   - Having minimal dependencies

4. *ellama*
   
   - *Pros*:
     - Tight integration with Emacs org-mode
     - Extensive built-in prompt templates
     - Support for streaming responses
     - Good documentation and examples

   =ollama-buddy= differs by:
   - Having a simpler, more streamlined setup process
   - Providing a more lightweight, menu-driven interface
   - Focusing on quick, direct interactions from any buffer
   - Having minimal dependencies and configuration requirements

* Issues

Report issues on the [[https://github.com/captainflasmr/ollama-buddy/issues][GitHub Issues page]]

* Contributing

Contributions are welcome! Please:
1. Fork the repository
2. Create a feature branch
3. Commit your changes
4. Open a pull request

* License

[[https://opensource.org/licenses/MIT][MIT License]]

* Acknowledgments

- [[https://ollama.ai/][Ollama]] for making local LLM inference accessible
- Emacs community for continuous inspiration
